<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="/Frontend/CSS/style.css" />
    <link rel="stylesheet" type="text/css" href="/Frontend/CSS/user.css" />
    <script src="../../Javascript/pageBasket.js"></script>
    <script src="../../Javascript/includeHTML.js"></script>
    <script src="../../Javascript/basket.js"></script>
    <script src="../../Javascript/basket_price.js"></script>

    <title>장바구니 목록</title>
  </head>
  <body>
    <div id="wrapper">
      <header include-html="/Frontend/HTML/Main/header.html"></header>
      <nav include-html="/Frontend/HTML/Main/nav.html"></nav>
      <main>
        <div id="mypage_center">
          <div class="mypage_list">
            <ul>
              <li>
                <a href="./basket.html"><strong>내 장바구니</strong></a>
              </li>
              <li><a href="./edit.html">회원정보수정</a></li>
              <li><a href="./withdraw.html">회원탈퇴</a></li>
            </ul>
          </div>
          <div class="mypage_introduction">
            <div class="basket_list">
              <div class="basket_title">내 장바구니</div>
              <p>장바구니에 담긴 상품 목록입니다.</p>
              <div class="basket_tables">
                <table class="basket_table">
                  <thead>
                    <tr>
                      <th></th>
                      <th class="basket_num">주문번호</th>
                      <th class="basket_name">상품명</th>
                      <th>가격</th>
                      <th>수량</th>
                      <th>총가격</th>
                    </tr>
                  </thead>
                  <!-- HTML 코드 일부분 -->
                  <tbody>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                    <tr class="t_tr">
                      <th><input type="checkbox" /></th>
                      <td>1</td>
                      <td class="basket_proName">맛있는 초콜릿맛</td>
                      <td class="basket_proPrice">13,000원</td>
                      <td>
                        <input
                          type="number"
                          class="basket_quantity"
                          id="cquantity"
                          name="cquantity"
                          value="1"
                          min="1"
                          max="1000"
                          readonly
                        />
                      </td>
                      <td class="basket_total">13,000원</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div id="pagination-container"></div>
            </div>
            <div class="basket_result">
              <div class="result" id="totalPrice">총 주문금액 :</div>
            </div>
            <div class="basket_btns">
              <button class="basket_btn" type="submit">상품주문하기</button>
              <button class="basket_btn">상품삭제</button>
              <button class="basket_edit_btn">상품수정</button>
            </div>
          </div>
        </div>
      </main>
      <footer include-html="/Frontend/HTML/Main/footer.html"></footer>
    </div>
  </body>
  <script>
    includeHTML()

    document.addEventListener("DOMContentLoaded", function () {
      const deleteButtons = document.querySelectorAll(".basket_btn")

      deleteButtons.forEach(function (button) {
        button.addEventListener("click", function () {
          const checkedCheckboxes = document.querySelectorAll(
            '.t_tr input[type="checkbox"]:checked'
          )

          checkedCheckboxes.forEach(function (checkbox) {
            const row = checkbox.closest(".t_tr")
            row.remove()
          })

          // Update the page content and recalculate the total price
          updatePageContent()
        })
      })

      function updatePageContent() {
        // Recalculate the total price
        updateTotalPrice()
      }

      function updateTotalPrice() {
        let totalPrice = 0
        const basketTotalElements = document.querySelectorAll(".t_tr")

        basketTotalElements.forEach(function (row) {
          if (row.querySelector('input[type="checkbox"]').checked) {
            const priceElement = row.querySelector(".basket_proPrice")
            const quantityElement = row.querySelector(".basket_quantity")
            const price = parseFloat(
              priceElement.textContent.replace("원", "").replace(",", "")
            )
            const quantity = parseInt(quantityElement.value)

            totalPrice += price * quantity
          }
        })

        const totalPriceElement = document.getElementById("totalPrice")
        if (totalPrice > 0) {
          totalPriceElement.textContent =
            "총 주문금액 : " + totalPrice.toLocaleString() + "원"
        } else {
          totalPriceElement.textContent = "총 주문금액 : 0원"
        }
      }
    })
  </script>
</html>
